{% extends "base.html" %}
{% block title %}–ü—Ä–∏–≤–µ—Ç, {{ current_user.name }} {{ current_user.surname }}{% endblock %}
    {% block style %}
{#        <link rel="stylesheet" href="{{ url_for('static', filename='main.css/base_design_post.css')}}">#}
        <link rel="stylesheet" href="{{ url_for('static', filename='main.css/home.css')}}">
        <link rel="stylesheet" href="{{ url_for('static', filename='main.css/base_page.css')}}">
        <link rel="stylesheet" href="{{ url_for('static', filename='main.css/profile_style.css')}}">
    {% endblock%}

{% block content %}

<div class="info_profile">
    <div class="image_profile"></div>
    <div class="about_profile">
        <h1>{{ user.blogname }}</h1>
        <p>{{ user.description }}</p>
    </div>
</div>

<div class="container_body">

            {% if posts %} <!-- –µ—Å–ª–∏ –ø–æ—Å—Ç–æ–≤ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ -->
            {% for post in posts %} <!-- –î–æ–±–∞–≤–ª–µ–Ω —Ü–∏–∫–ª –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤ -->

        <div class="post-card" id="{{ post.id }}">
    <article class="post-card__article">
        <a class="post-card__link" href="{{ url_for('view_post', post_id=post.id) }}" rel="opener dofollow" aria-label="–ß–∏—Ç–∞—Ç—å –ø–æ—Å—Ç '{{ post.title }}'"></a>
{#        {% if current_user.is_authenticated %}#}
            {% if user.id==current_user.id %}
        <div class="dropdown">
            <input type="checkbox" class="dropdown-checkbox">
            <div class="dropdown-label">‚ãÆ</div>

            <div class="dropdown-menu">
                <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <form action="/post/{{ post.id }}/edit" method="GET" class="dropdown-form">
                    <button type="submit" class="dropdown-item edit-btn">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>

                <!-- –§–æ—Ä–º–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è -->
                <form action="/post/{{ post.id }}/delete" method="POST" class="dropdown-form">
                    <button type="submit" class="dropdown-item delete-btn"
                            onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </form>
            </div>
        </div>
    {% endif %}

        <!-- –ë–ª–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        <div class="post-card__image">
            {% set first_img_src = extract_first_image(post.content) %}
            {% if first_img_src %}
                <img src="{{ first_img_src }}" alt="{{ post.title }}" loading="lazy"/>
            {% else %}
                <div class="post-card__image-placeholder"></div>
            {% endif %}
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <div class="post-card__user">
            <div class="post-card__user-avatar"></div>
            <div class="post-card__user-info">
                <p class="post-card__username">{{ post.user.blogname }}</p>
                <time class="post-card__date" datetime="{{ post.created_at.isoformat() }}">
                    {{ post.created_at.strftime('%d.%m.%Y %H:%M') }}
                </time>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–∞ -->
        <div class="post-card__content">
            <h2 class="post-card__title">{{ post.title[:50] }}{% if post.title|length > 50 %}...{% endif %}</h2>
            <div class="post-card__excerpt">
                {{ post.content|striptags|truncate(100) }}
            </div>
        </div>

        <!-- –§—É—Ç–µ—Ä –ø–æ—Å—Ç–∞ -->
        <footer class="post-card__footer">
            <form action="/toggle_like/{{ post.id }}" method="POST" class="post-card__action">
                <button type="submit" class="post-card__action--like" aria-label="–õ–∞–π–∫–Ω—É—Ç—å –ø–æ—Å—Ç">
                    <img src="{{ url_for('static', filename='like_post.png') }}" alt="" aria-hidden="true">
                </button>
            </form>
            <p>{{ Like.query.filter_by(post_id=post.id).count() }}</p>
            <a href="{{ url_for('view_post', post_id=post.id) }}#comments" class="post-card__action post-card__action--comment" aria-label="–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç">
                <img class="comment_post" src="{{ url_for('static', filename='comment.png') }}" alt="–ö–æ–º–º–µ–Ω—Ç">
            </a>
            <p>{{ Comment.query.filter_by(post_id=post.id).count() }}</p>
        </footer>
    </article>
</div>
            {% endfor %}
    {% else %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤. <a href="{{ url_for('create_post') }}">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π!</a></p>
            {% endif %}


</div>
{% endblock %}



